import{q as b,d,H as Y,A as Z,e as v,a as e,f as P,n as l,l as _,v as x,t as u,K as ee,F as T,i as $,h,k as oe,L as q,o as p}from"./app-DZXOPLfm.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"flex gap-4 mb-6"},ae=["disabled"],le=["value"],se={class:"col-span-2"},ne={class:"col-span-2"},ue={key:0,class:"mt-2 flex items-center gap-2"},ie=["src"],de={class:"col-span-2 flex justify-end gap-2 mt-2"},ve={type:"submit",class:"btn-green"},pe={key:0,class:"overflow-x-auto"},ce={class:"px-2 py-2"},be={class:"px-2 py-2"},me={class:"px-2 py-2"},ge={class:"px-2 py-2"},fe={class:"px-2 py-2 space-x-2"},_e=["onClick"],ye=["onClick"],xe={key:0,class:"flex flex-col sm:flex-row justify-between items-center gap-3 mt-4 text-sm"},he={class:"flex items-center gap-2"},we=["disabled"],ke=["disabled"],Ce={__name:"Proveedores",props:{darkMode:{type:Boolean,default:!1},fontClass:{type:String,default:"font-sans"}},setup(j){const B=t=>t?t.startsWith("http")?t:`${"https://www.tecnoweb.org.bo/inf513/grupo06cc/metaluv-camiri/public/".replace(/\/$/,"").replace("/public","")}/storage/app/public/${t}`:null,M=j,s=b(()=>M.darkMode),D=b(()=>M.fontClass),n=d([]),V=d([]),m=d(!1),U=d(""),c=d(!1),E=d(null),a=d({id_proveedor:"",id_usuario:"",nombre_empres_prov:"",tipo_materiales_prov:"",telefono_prov:"",correo_prov:"",direccion_prov:"",codigoqr:null}),y=d(null),g=d(null),i=d(1),w=d(10),C=b(()=>n.value.length?Math.ceil(n.value.length/w.value):0),I=b(()=>{const t=(i.value-1)*w.value;return n.value.slice(t,t+w.value)}),N=b(()=>n.value.length?(i.value-1)*w.value+1:0),A=b(()=>n.value.length?Math.min(i.value*w.value,n.value.length):0);function F(){i.value<C.value&&i.value++}function Q(){i.value>1&&i.value--}Y(n,()=>{i.value=1});const z=b(()=>{const t=new Set(n.value.map(r=>r.id_usuario).filter(r=>r)),o=a.value.id_usuario;return V.value.filter(r=>r.id_usuario.startsWith("prov_m")?c.value&&r.id_usuario===o?!0:!t.has(r.id_usuario):!1)}),f=b(()=>s.value?"bg-gray-900 border-gray-700 text-gray-100 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-400");function O(t){const o=t.target.files[0];o&&(a.value.codigoqr=o,y.value=URL.createObjectURL(o))}function W(){a.value.codigoqr=null,y.value=null,g.value&&(g.value.value=null)}async function G(){const t=new FormData;t.append("id_usuario",a.value.id_usuario||""),t.append("nombre_empres_prov",a.value.nombre_empres_prov),t.append("tipo_materiales_prov",a.value.tipo_materiales_prov),t.append("telefono_prov",a.value.telefono_prov||""),t.append("correo_prov",a.value.correo_prov||""),t.append("direccion_prov",a.value.direccion_prov||""),a.value.codigoqr&&t.append("codigoqr",a.value.codigoqr);const o=c.value?`propietario/melamina/proveedores/${E.value}`:"propietario/melamina/proveedores";try{(await q.post(o,t,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(alert(c.value?"Proveedor actualizado":"Proveedor registrado"),L(),await k(),await R())}catch{alert("Error al guardar proveedor")}}function H(t){c.value=!0,E.value=t.id_proveedor,a.value.id_proveedor=t.id_proveedor,a.value.id_usuario=t.id_usuario,a.value.nombre_empres_prov=t.nombre_empres_prov,a.value.tipo_materiales_prov=t.tipo_materiales_prov,a.value.telefono_prov=t.telefono_prov,a.value.correo_prov=t.correo_prov,a.value.direccion_prov=t.direccion_prov,a.value.codigoqr=null,y.value=B(t.codigoqr_prov),g.value&&(g.value.value=null)}function K(){c.value=!1,L()}function J(t){confirm("Â¿Eliminar este proveedor?")&&q.delete(`propietario/melamina/proveedores/${t}`).then(o=>{alert(o.data.message||"Proveedor eliminado"),k()}).catch(()=>alert("Error al eliminar proveedor"))}function L(){c.value=!1,E.value=null,y.value=null,g.value&&(g.value.value=null),a.value={id_proveedor:"",id_usuario:"",nombre_empres_prov:"",tipo_materiales_prov:"",telefono_prov:"",correo_prov:"",direccion_prov:"",codigoqr:null}}function k(){q.get("propietario/melamina/proveedores",{params:{buscar:U.value}}).then(t=>{n.value=t.data.proveedores||[],m.value=!0}).catch(()=>alert("Error al obtener proveedores"))}function X(){m.value=!m.value,m.value&&k()}async function R(){try{const t=await q.get("propietario/melamina/usuarios");V.value=t.data.usuarios||[]}catch(t){console.error("Error al cargar usuarios",t)}}return Z(async()=>{await Promise.all([R(),k()])}),(t,o)=>(p(),v("div",{class:l(["p-8 rounded-2xl shadow-md transition-colors duration-300",s.value?"bg-gray-800 text-gray-100":"bg-white text-gray-900",D.value])},[e("h2",{class:l(["text-2xl font-bold mb-6",s.value?"text-blue-400":"text-blue-700"])}," GestiÃ³n de Proveedores ",2),e("div",re,[_(e("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>U.value=r),type:"text",placeholder:"ðŸ” Buscar por nombre, tipo, telÃ©fono o correo...",class:l(["input flex-1",f.value])},null,2),[[x,U.value]]),e("button",{onClick:k,class:"btn-blue"},"Buscar"),e("button",{onClick:X,class:"btn-gray"},u(m.value?"Ocultar Lista":"Listar"),1)]),e("form",{onSubmit:oe(G,["prevent"]),class:"grid grid-cols-2 gap-4 mb-6"},[e("div",null,[o[9]||(o[9]=e("label",{class:"block text-sm font-semibold mb-1"},"ID Usuario (proveedor)",-1)),_(e("select",{"onUpdate:modelValue":o[1]||(o[1]=r=>a.value.id_usuario=r),class:l(["input",f.value]),disabled:c.value},[o[7]||(o[7]=e("option",{disabled:"",value:""},"Seleccione usuario",-1)),(p(!0),v(T,null,$(z.value,r=>(p(),v("option",{key:r.id_usuario,value:r.id_usuario},u(r.id_usuario),9,le))),128))],10,ae),[[ee,a.value.id_usuario]]),e("p",{class:l(["text-xs mt-1",s.value?"text-gray-300":"text-gray-500"])},[...o[8]||(o[8]=[h(" Se muestran solo usuarios ",-1),e("b",null,"prov_m",-1),h(" que aÃºn no estÃ¡n asignados a un proveedor. ",-1)])],2)]),e("div",null,[o[10]||(o[10]=e("label",{class:"block text-sm font-semibold mb-1"},"Nombre Empresa",-1)),_(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=r=>a.value.nombre_empres_prov=r),class:l(["input",f.value])},null,2),[[x,a.value.nombre_empres_prov]])]),e("div",null,[o[11]||(o[11]=e("label",{class:"block text-sm font-semibold mb-1"},"Tipo de Materiales",-1)),_(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=r=>a.value.tipo_materiales_prov=r),class:l(["input",f.value])},null,2),[[x,a.value.tipo_materiales_prov]])]),e("div",null,[o[12]||(o[12]=e("label",{class:"block text-sm font-semibold mb-1"},"TelÃ©fono",-1)),_(e("input",{type:"text","onUpdate:modelValue":o[4]||(o[4]=r=>a.value.telefono_prov=r),class:l(["input",f.value])},null,2),[[x,a.value.telefono_prov]])]),e("div",null,[o[13]||(o[13]=e("label",{class:"block text-sm font-semibold mb-1"},"Correo",-1)),_(e("input",{type:"email","onUpdate:modelValue":o[5]||(o[5]=r=>a.value.correo_prov=r),class:l(["input",f.value])},null,2),[[x,a.value.correo_prov]])]),e("div",se,[o[14]||(o[14]=e("label",{class:"block text-sm font-semibold mb-1"},"DirecciÃ³n",-1)),_(e("input",{type:"text","onUpdate:modelValue":o[6]||(o[6]=r=>a.value.direccion_prov=r),class:l(["input",f.value])},null,2),[[x,a.value.direccion_prov]])]),e("div",ne,[o[15]||(o[15]=e("label",{class:"block text-sm font-semibold mb-1"},"CÃ³digo QR",-1)),e("input",{type:"file",ref_key:"qrInput",ref:g,onChange:O,class:l(["input",[s.value?"bg-gray-900 border-gray-700 text-gray-100 file:bg-blue-600 file:text-white":"bg-white border-gray-300 text-gray-900 file:bg-blue-600 file:text-white"]])},null,34),y.value?(p(),v("div",ue,[e("img",{src:y.value,class:l(["w-24 h-24 rounded-lg object-cover",s.value?"border border-gray-600":"border border-gray-300"])},null,10,ie),e("button",{type:"button",onClick:W,class:"text-red-500 text-sm font-semibold"}," âœ– Quitar ")])):P("",!0)]),e("div",de,[e("button",ve,u(c.value?"Actualizar":"Registrar"),1),c.value?(p(),v("button",{key:0,type:"button",onClick:K,class:"btn-gray"}," Cancelar ")):P("",!0)])],32),m.value&&n.value.length?(p(),v("div",pe,[e("table",{class:l(["w-full rounded-lg text-sm text-center",s.value?"border border-gray-700":"border border-gray-200"])},[o[16]||(o[16]=e("thead",{class:"bg-blue-600 text-white"},[e("tr",null,[e("th",{class:"px-2 py-2"},"Empresa"),e("th",{class:"px-2 py-2"},"Tipo Materiales"),e("th",{class:"px-2 py-2"},"TelÃ©fono"),e("th",{class:"px-2 py-2"},"Correo"),e("th",{class:"px-2 py-2"},"Acciones")])],-1)),e("tbody",null,[(p(!0),v(T,null,$(I.value,r=>(p(),v("tr",{key:r.id_proveedor,class:l(["border-b",s.value?"border-gray-700 hover:bg-gray-800":"border-gray-200 hover:bg-gray-50"])},[e("td",ce,u(r.nombre_empres_prov),1),e("td",be,u(r.tipo_materiales_prov),1),e("td",me,u(r.telefono_prov),1),e("td",ge,u(r.correo_prov),1),e("td",fe,[e("button",{onClick:S=>H(r),class:"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-xs"}," âœï¸ Editar ",8,_e),e("button",{onClick:S=>J(r.id_proveedor),class:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs"}," ðŸ—‘ Eliminar ",8,ye)])],2))),128))])],2),n.value.length?(p(),v("div",xe,[e("span",{class:l(s.value?"text-gray-300":"text-gray-600")},[o[17]||(o[17]=h(" Mostrando ",-1)),e("b",null,u(N.value),1),o[18]||(o[18]=h(" - ",-1)),e("b",null,u(A.value),1),o[19]||(o[19]=h(" de ",-1)),e("b",null,u(n.value.length),1),o[20]||(o[20]=h(" proveedores ",-1))],2),e("div",he,[e("button",{type:"button",onClick:Q,disabled:i.value===1,class:l(["px-3 py-1 rounded-lg border text-xs font-semibold disabled:opacity-50 disabled:cursor-not-allowed",s.value?"border-gray-600 text-gray-100 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," â—€ Anterior ",10,we),e("span",{class:l(s.value?"text-gray-200":"text-gray-700")}," PÃ¡gina "+u(i.value)+" de "+u(C.value),3),e("button",{type:"button",onClick:F,disabled:i.value===C.value||C.value===0,class:l(["px-3 py-1 rounded-lg border text-xs font-semibold disabled:opacity-50 disabled:cursor-not-allowed",s.value?"border-gray-600 text-gray-100 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," Siguiente â–¶ ",10,ke)])])):P("",!0)])):m.value&&!n.value.length?(p(),v("div",{key:1,class:l(["mt-4 text-center text-sm",s.value?"text-gray-300":"text-gray-500"])}," No hay proveedores con el criterio actual ",2)):P("",!0)],2))}},Ue=te(Ce,[["__scopeId","data-v-4c045279"]]);export{Ue as default};
