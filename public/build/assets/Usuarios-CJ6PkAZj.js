import{q as p,d as y,H as W,A as X,e as d,a,f,n as s,l as L,v as P,t as c,F as Y,i as Z,h as I,L as k,o as v}from"./app-DZXOPLfm.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},te={class:"flex items-center justify-between mb-1"},se={class:"flex gap-2"},re=["disabled"],oe=["disabled"],le=["disabled"],ue={key:0,class:"text-red-500 text-xs mt-1"},ne={key:0,class:"text-red-500 text-xs mt-1"},ie={class:"flex items-center gap-3 mb-6"},de={class:"flex flex-wrap gap-2 mb-4"},ce={key:1,class:"mt-6 overflow-x-auto"},ve=["onClick"],ge=["onClick"],be=["onClick"],xe={key:0,class:"flex flex-col md:flex-row justify-between items-center gap-3 mt-4 text-xs md:text-sm"},pe={class:"flex items-center gap-2"},ye=["disabled"],me=["disabled"],_=5,fe={__name:"Usuarios",props:{darkMode:{type:Boolean,default:!1},fontClass:{type:String,default:"font-sans"}},setup(z){const D=z,n=p(()=>D.darkMode),B=p(()=>D.fontClass||"font-sans"),M=p(()=>n.value?"bg-gray-900 border-gray-700 text-gray-100 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"),m=p(()=>n.value?"border border-gray-700":"border border-gray-300"),r=y({id_usuario:"",contrasenia:"",estado_usuario:!0}),x=y({}),i=y([]),l=y(""),u=y("text-green-600"),h=y(!1),b=y(!1),g=y(1),C=p(()=>i.value.length?Math.ceil(i.value.length/_):0),S=p(()=>{const t=(g.value-1)*_;return i.value.slice(t,t+_)}),V=p(()=>i.value.length?(g.value-1)*_+1:0),F=p(()=>i.value.length?Math.min(g.value*_,i.value.length):0);function N(){g.value<C.value&&g.value++}function T(){g.value>1&&g.value--}W(i,()=>{g.value=1});function U(t){const e=new RegExp("^"+t+"(\\d+)$");let o=0;i.value.forEach(Q=>{const j=Q.id_usuario.match(e);if(j){const A=parseInt(j[1],10);A>o&&(o=A)}});const $=o+1;r.value.id_usuario=`${t}${$}`}function E(){r.value={id_usuario:"",contrasenia:"",estado_usuario:!0},x.value={},b.value=!1}function q(){E(),l.value="Edición cancelada",u.value="text-gray-500"}async function w(){try{const t=await k.get("propietario/Construccion/usuarios");i.value=t.data.usuarios||[],l.value="Lista de usuarios actualizada",u.value="text-green-600"}catch(t){console.error(t),l.value="Error al conectar con el servidor",u.value="text-red-600"}}async function R(){h.value?h.value=!1:(await w(),h.value=!0)}async function H(){x.value={},l.value="";try{const t={id_usuario:r.value.id_usuario,contrasenia:r.value.contrasenia,estado_usuario:r.value.estado_usuario},e=await k.post("propietario/Construccion/usuarios",t);e.data.success?(l.value=e.data.message,u.value="text-green-600",E(),await w()):(l.value=e.data.message||"Error al registrar usuario",u.value="text-red-600")}catch(t){console.error(t),t.response?.status===422?(x.value=t.response.data.errors||{},l.value="Corrige los errores del formulario",u.value="text-red-600"):(l.value="Error al conectar con el servidor",u.value="text-red-600")}}function O(t){r.value.id_usuario=t.id_usuario,r.value.contrasenia="",r.value.estado_usuario=t.estado_usuario,b.value=!0,l.value=`Editando usuario: ${t.id_usuario}`,u.value="text-blue-600"}async function G(){x.value={},l.value="";try{const t={contrasenia:r.value.contrasenia||null,estado_usuario:r.value.estado_usuario},e=await k.put(`propietario/Construccion/usuarios/${r.value.id_usuario}`,t);e.data.success?(l.value=e.data.message,u.value="text-green-600",b.value=!1,r.value.contrasenia="",await w()):(l.value=e.data.message||"Error al actualizar usuario",u.value="text-red-600")}catch(t){console.error(t),t.response?.status===422?(x.value=t.response.data.errors||{},l.value="Corrige los errores del formulario",u.value="text-red-600"):(l.value="Error al conectar con el servidor",u.value="text-red-600")}}async function J(t){try{const e=await k.patch(`propietario/Construccion/usuarios/${t.id_usuario}/estado`);e.data.success&&(t.estado_usuario=e.data.usuario.estado_usuario)}catch(e){console.error(e),l.value="Error al cambiar estado",u.value="text-red-600"}}async function K(t){if(confirm(`¿Seguro que deseas eliminar el usuario "${t.id_usuario}"?`))try{const e=await k.delete(`propietario/Construccion/usuarios/${t.id_usuario}`);e.data.success&&(l.value=e.data.message,u.value="text-green-600",await w(),b.value&&r.value.id_usuario===t.id_usuario&&E())}catch(e){console.error(e),l.value="Error al eliminar usuario",u.value="text-red-600"}}return X(()=>{w()}),(t,e)=>(v(),d("div",{class:s(["p-8 rounded-2xl shadow-md transition-colors duration-300",n.value?"bg-gray-900 text-gray-100":"bg-white text-gray-900",B.value])},[a("h2",{class:s(["text-2xl font-bold mb-6",n.value?"text-blue-400":"text-blue-700"])}," Asignar acceso al sistema ",2),a("div",ae,[a("div",null,[a("div",te,[e[6]||(e[6]=a("label",{class:"block text-sm font-semibold"},"ID Usuario",-1)),a("div",se,[a("button",{type:"button",class:"px-3 py-1 rounded-lg text-[11px] md:text-xs bg-blue-500 text-white hover:bg-emerald-600",onClick:e[0]||(e[0]=o=>U("cli_c")),disabled:b.value}," Crear ID Cliente ",8,re),a("button",{type:"button",class:"px-3 py-1 rounded-lg text-[11px] md:text-xs bg-blue-500 text-white hover:bg-blue-600",onClick:e[1]||(e[1]=o=>U("trab_c")),disabled:b.value}," Crear ID Trabajador ",8,oe),a("button",{type:"button",class:"px-3 py-1 rounded-lg text-[11px] md:text-xs bg-blue-500 text-white hover:bg-amber-600",onClick:e[2]||(e[2]=o=>U("prov_c")),disabled:b.value}," Crear ID Proveedor ",8,le)])]),L(a("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=o=>r.value.id_usuario=o),readonly:"",class:s(["input cursor-not-allowed",[M.value,n.value?"bg-gray-800 text-gray-300 border-gray-700":"bg-gray-100 text-gray-700 border-gray-300"]]),placeholder:"Ej: cli_c1, trab_c2, prov_c3..."},null,2),[[P,r.value.id_usuario]]),a("p",{class:s(["text-xs mt-1",n.value?"text-gray-300":"text-gray-500"])}," El ID se genera con los botones según el tipo. Solo escribe la contraseña. ",2),x.value.id_usuario?(v(),d("p",ue,c(x.value.id_usuario),1)):f("",!0)]),a("div",null,[e[7]||(e[7]=a("label",{class:"block text-sm font-semibold mb-1"},"Contraseña",-1)),L(a("input",{type:"password","onUpdate:modelValue":e[4]||(e[4]=o=>r.value.contrasenia=o),class:s(["input",M.value]),placeholder:"Escribe la contraseña"},null,2),[[P,r.value.contrasenia]]),x.value.contrasenia?(v(),d("p",ne,c(x.value.contrasenia),1)):f("",!0),b.value?(v(),d("p",{key:1,class:s(["text-xs mt-1",n.value?"text-gray-300":"text-gray-500"])}," Deja la contraseña en blanco si no deseas cambiarla. ",2)):f("",!0)])]),a("div",ie,[e[8]||(e[8]=a("span",{class:"font-semibold"},"Estado:",-1)),a("button",{type:"button",onClick:e[5]||(e[5]=o=>r.value.estado_usuario=!r.value.estado_usuario),class:s(["relative inline-flex items-center h-6 rounded-full w-11 transition-colors",r.value.estado_usuario?"bg-green-500":"bg-gray-400"])},[a("span",{class:s(["inline-block w-4 h-4 transform bg-white rounded-full transition-transform",r.value.estado_usuario?"translate-x-6":"translate-x-1"])},null,2)],2),a("span",{class:s(r.value.estado_usuario?"text-green-500":"text-gray-400")},c(r.value.estado_usuario?"Activo":"Inactivo"),3)]),a("div",de,[b.value?(v(),d("button",{key:1,onClick:G,class:"bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-1.5 rounded-lg font-semibold text-xs md:text-sm"}," Actualizar ")):(v(),d("button",{key:0,onClick:H,class:"bg-green-600 hover:bg-green-700 text-white px-4 py-1.5 rounded-lg font-semibold text-xs md:text-sm"}," Registrar ")),a("button",{type:"button",onClick:R,class:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-1.5 rounded-lg font-semibold text-xs md:text-sm"},c(h.value?"Ocultar lista":"Listar"),1),a("button",{type:"button",onClick:E,class:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-1.5 rounded-lg font-semibold text-xs md:text-sm"}," Limpiar "),b.value?(v(),d("button",{key:2,type:"button",onClick:q,class:"bg-red-500 hover:bg-red-600 text-white px-4 py-1.5 rounded-lg font-semibold text-xs md:text-sm"}," Cancelar edición ")):f("",!0)]),l.value?(v(),d("p",{key:0,class:s([u.value,"mt-2 font-semibold"])},c(l.value),3)):f("",!0),h.value&&i.value.length?(v(),d("div",ce,[e[13]||(e[13]=a("h3",{class:"font-bold mb-2"},"Usuarios con acceso al sistema",-1)),a("table",{class:s(["w-full text-center text-sm rounded-lg overflow-hidden",n.value?"border border-gray-700":"border border-gray-300"])},[a("thead",{class:s(n.value?"bg-gray-800 text-gray-100":"bg-gray-100")},[a("tr",null,[a("th",{class:s(["border p-2",m.value])},"ID Usuario",2),a("th",{class:s(["border p-2",m.value])},"Estado",2),a("th",{class:s(["border p-2",m.value])},"Acciones",2)])],2),a("tbody",null,[(v(!0),d(Y,null,Z(S.value,o=>(v(),d("tr",{key:o.id_usuario,class:s([n.value?"hover:bg-gray-800":"hover:bg-gray-50",m.value])},[a("td",{class:s(["border p-2",m.value])},c(o.id_usuario),3),a("td",{class:s(["border p-2",m.value])},[a("button",{type:"button",onClick:$=>J(o),class:s(["relative inline-flex items-center h-5 rounded-full w-10 transition-colors",o.estado_usuario?"bg-green-500":"bg-gray-400"])},[a("span",{class:s(["inline-block w-4 h-4 transform bg-white rounded-full transition-transform",o.estado_usuario?"translate-x-5":"translate-x-1"])},null,2)],10,ve),a("span",{class:s(["ml-2 text-xs md:text-sm",o.estado_usuario?"text-green-500":"text-gray-400"])},c(o.estado_usuario?"Activo":"Inactivo"),3)],2),a("td",{class:s(["border p-2 space-x-2",m.value])},[a("button",{onClick:$=>O(o),class:"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-[11px] md:text-xs"}," Editar ",8,ge),a("button",{onClick:$=>K(o),class:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-[11px] md:text-xs"}," Eliminar ",8,be)],2)],2))),128))])],2),i.value.length>_?(v(),d("div",xe,[a("span",{class:s(n.value?"text-gray-300":"text-gray-600")},[e[9]||(e[9]=I(" Mostrando ",-1)),a("b",null,c(V.value),1),e[10]||(e[10]=I(" - ",-1)),a("b",null,c(F.value),1),e[11]||(e[11]=I(" de ",-1)),a("b",null,c(i.value.length),1),e[12]||(e[12]=I(" usuarios ",-1))],2),a("div",pe,[a("button",{type:"button",onClick:T,disabled:g.value===1,class:s(["px-3 py-1 rounded-lg border font-semibold disabled:opacity-50 disabled:cursor-not-allowed",n.value?"border-gray-600 text-gray-100 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," ◀ Anterior ",10,ye),a("span",{class:s(n.value?"text-gray-200":"text-gray-700")}," Página "+c(g.value)+" de "+c(C.value),3),a("button",{type:"button",onClick:N,disabled:g.value===C.value||C.value===0,class:s(["px-3 py-1 rounded-lg border font-semibold disabled:opacity-50 disabled:cursor-not-allowed",n.value?"border-gray-600 text-gray-100 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," Siguiente ▶ ",10,me)])])):f("",!0)])):f("",!0)],2))}},we=ee(fe,[["__scopeId","data-v-20d3251a"]]);export{we as default};
