import{q as m,d as u,H as T,A as xe,L as w,e as i,a as e,f as x,n as r,l as f,v as h,t as s,k as K,F as j,i as B,h as _,K as J,o as n}from"./app-DZXOPLfm.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"grid grid-cols-3 gap-4 mb-4"},he={class:"col-span-2"},ke={class:"flex items-end gap-2 justify-end"},Se={class:"col-span-2"},Ce={class:"col-span-2 flex justify-end gap-2"},De={type:"submit",class:"btn-green text-xs md:text-sm"},we={key:0,class:"overflow-x-auto mb-8"},Ee={class:"px-2 py-2"},Pe={class:"px-2 py-2"},Me={class:"px-2 py-2"},Ne={class:"px-2 py-2"},Ve={class:"px-2 py-2 space-x-2"},Ue=["onClick"],Le=["onClick"],$e={key:0},Ae={key:0,class:"flex flex-col md:flex-row justify-between items-center gap-3 mt-4 text-xs md:text-sm"},je={class:"flex items-center gap-2"},Be=["disabled"],Ie=["disabled"],ze={key:1,class:"border-t pt-6 mt-4"},Fe={class:"flex justify-between items-center mb-4"},Te=["value"],Oe=["value"],Re={class:"col-span-2 flex justify-end gap-2"},qe={type:"submit",class:"btn-indigo text-xs md:text-sm"},Ge={key:0,class:"overflow-x-auto"},He={class:"px-2 py-2"},Ke={class:"px-2 py-2"},Je={class:"px-2 py-2"},Qe={class:"px-2 py-2"},We={class:"px-2 py-2 space-x-2"},Xe=["onClick"],Ye=["onClick"],Ze={key:0},et={key:0,class:"flex flex-col md:flex-row justify-between items-center gap-3 mt-4 text-xs md:text-sm"},tt={class:"flex items-center gap-2"},ot=["disabled"],lt=["disabled"],E=5,P=5,rt={__name:"Servicios",props:{darkMode:{type:Boolean,default:!1},fontClass:{type:String,default:"font-sans"}},setup(Q){const O=Q,a=m(()=>O.darkMode),W=m(()=>O.fontClass||"font-sans"),y=m(()=>a.value?"bg-gray-900 border-gray-700 text-gray-100 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"),v=u([]),V=u(""),k=u(!1),S=u(!1),I=u(null),p=u({nombre_servicio:"",descripcion_serv:"",precio_serv:"",tiempo_estimado_serv:""}),b=u(1),U=m(()=>v.value.length?Math.ceil(v.value.length/E):0),X=m(()=>{const l=(b.value-1)*E;return v.value.slice(l,l+E)}),Y=m(()=>v.value.length?(b.value-1)*E+1:0),Z=m(()=>v.value.length?Math.min(b.value*E,v.value.length):0);function ee(){b.value<U.value&&b.value++}function te(){b.value>1&&b.value--}T(v,()=>{b.value=1});const M=u(!1),C=u(!1),c=u([]),R=u([]),N=u([]),D=u(!1),z=u(null),d=u({id_proyecto:"",id_servicio:"",precio_unitario:"",sub_total:""}),g=u(1),L=m(()=>c.value.length?Math.ceil(c.value.length/P):0),oe=m(()=>{const l=(g.value-1)*P;return c.value.slice(l,l+P)}),le=m(()=>c.value.length?(g.value-1)*P+1:0),re=m(()=>c.value.length?Math.min(g.value*P,c.value.length):0);function se(){g.value<L.value&&g.value++}function ae(){g.value>1&&g.value--}T(c,()=>{g.value=1}),T(()=>d.value.id_servicio,l=>{if(!l)return;const t=N.value.find(o=>o.id_servicio===l);t&&(d.value.precio_unitario=t.precio_serv,d.value.sub_total=t.precio_serv)}),xe(()=>{q()});function q(l={}){return w.get("propietario/Construccion/servicios",{params:l}).then(t=>{v.value=t.data.servicios||[],N.value=t.data.servicios||[]}).catch(t=>{console.error("Error al obtener servicios:",t),alert("Error al obtener servicios")})}function $(){const l={};V.value&&(l.buscar=V.value),q(l).then(()=>{k.value=!0})}function ie(){k.value=!k.value,k.value&&$()}function ne(){const l=S.value?`propietario/Construccion/servicios/${I.value}`:"propietario/Construccion/servicios";w.post(l,p.value).then(t=>{t.data.success&&(alert(S.value?"Servicio actualizado":"Servicio registrado"),G(),$())}).catch(t=>{console.error("Error al guardar servicio:",t),alert("Error al guardar servicio")})}function ue(l){S.value=!0,I.value=l.id_servicio,p.value={nombre_servicio:l.nombre_servicio,descripcion_serv:l.descripcion_serv,precio_serv:l.precio_serv,tiempo_estimado_serv:l.tiempo_estimado_serv}}function de(l){confirm("Â¿Eliminar este servicio?")&&w.delete(`propietario/Construccion/servicios/${l}`).then(()=>{alert("Servicio eliminado"),$()}).catch(t=>{console.error("Error al eliminar servicio:",t),alert("Error al eliminar servicio")})}function G(){S.value=!1,I.value=null,p.value={nombre_servicio:"",descripcion_serv:"",precio_serv:"",tiempo_estimado_serv:""}}function ce(){G()}function ve(){M.value=!M.value,M.value&&A()}function pe(){C.value=!C.value,C.value&&!c.value.length&&A()}function A(){return w.get("propietario/Construccion/proyecto-servicios").then(l=>{c.value=l.data.detalles||[],R.value=l.data.proyectos||[],N.value=l.data.servicios||N.value}).catch(l=>{console.error("Error al obtener detalle:",l),alert("Error al obtener detalle de servicios")})}function be(){const l=D.value?`propietario/Construccion/proyecto-servicios/${z.value}`:"propietario/Construccion/proyecto-servicios";w.post(l,d.value).then(t=>{t.data.success&&(alert(D.value?"Detalle actualizado":"Detalle registrado"),H(),A(),C.value=!0)}).catch(t=>{console.error("Error al guardar detalle:",t),alert("Error al guardar detalle")})}function ge(l){D.value=!0,z.value=l.id_proyecto_servicio,d.value={id_proyecto:l.id_proyecto,id_servicio:l.id_servicio,precio_unitario:l.precio_unitario,sub_total:l.sub_total}}function me(l){confirm("Â¿Eliminar este registro de detalle?")&&w.delete(`propietario/Construccion/proyecto-servicios/${l}`).then(()=>{alert("Detalle eliminado"),A()}).catch(t=>{console.error("Error al eliminar detalle:",t),alert("Error al eliminar detalle")})}function H(){D.value=!1,z.value=null,d.value={id_proyecto:"",id_servicio:"",precio_unitario:"",sub_total:""}}function ye(){H()}return(l,t)=>(n(),i("div",{class:r(["p-8 rounded-2xl shadow-md transition-colors duration-300",a.value?"bg-gray-800 text-gray-100":"bg-white text-gray-900",W.value])},[e("h2",{class:r(["text-2xl font-bold mb-6",a.value?"text-blue-400":"text-blue-700"])}," GestiÃ³n de Servicios ",2),e("div",_e,[e("div",he,[t[9]||(t[9]=e("label",{class:"block text-sm font-semibold mb-1"},"Buscar por nombre",-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>V.value=o),class:r(["input",y.value]),placeholder:"Nombre del servicio..."},null,2),[[h,V.value]])]),e("div",ke,[e("button",{onClick:$,class:"btn-blue text-xs md:text-sm"}," Buscar "),e("button",{onClick:ie,class:"btn-gray text-xs md:text-sm"},s(k.value?"Ocultar lista":"Listar todos"),1),e("button",{onClick:ve,class:"btn-indigo text-xs md:text-sm"},s(M.value?"Ocultar detalle":"Detalle proyecto-servicio"),1)])]),e("form",{onSubmit:K(ne,["prevent"]),class:"grid grid-cols-2 gap-4 mb-8"},[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-semibold mb-1"},"Nombre servicio",-1)),f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>p.value.nombre_servicio=o),class:r(["input",y.value])},null,2),[[h,p.value.nombre_servicio]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-semibold mb-1"},"Precio",-1)),f(e("input",{type:"number",step:"0.01","onUpdate:modelValue":t[2]||(t[2]=o=>p.value.precio_serv=o),class:r(["input",y.value])},null,2),[[h,p.value.precio_serv]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-semibold mb-1"},"Tiempo estimado",-1)),f(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=o=>p.value.tiempo_estimado_serv=o),class:r(["input",y.value])},null,2),[[h,p.value.tiempo_estimado_serv]])]),e("div",Se,[t[13]||(t[13]=e("label",{class:"block text-sm font-semibold mb-1"},"DescripciÃ³n",-1)),f(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=o=>p.value.descripcion_serv=o),class:r(["input",y.value]),rows:"2"},null,2),[[h,p.value.descripcion_serv]])]),e("div",Ce,[e("button",De,s(S.value?"Actualizar":"Registrar"),1),S.value?(n(),i("button",{key:0,type:"button",onClick:ce,class:"btn-gray text-xs md:text-sm"}," Cancelar ")):x("",!0)])],32),k.value?(n(),i("div",we,[e("table",{class:r(["w-full rounded-lg text-sm",a.value?"border border-gray-700":"border border-gray-200"])},[t[14]||(t[14]=e("thead",{class:"bg-blue-600 text-white"},[e("tr",null,[e("th",{class:"px-2 py-2"},"ID"),e("th",{class:"px-2 py-2"},"Nombre"),e("th",{class:"px-2 py-2"},"Precio"),e("th",{class:"px-2 py-2"},"Tiempo estimado"),e("th",{class:"px-2 py-2"},"Acciones")])],-1)),e("tbody",null,[(n(!0),i(j,null,B(X.value,o=>(n(),i("tr",{key:o.id_servicio,class:r(["border-b",a.value?"border-gray-700 hover:bg-gray-800":"border-gray-200 hover:bg-gray-50"])},[e("td",Ee,s(o.id_servicio),1),e("td",Pe,s(o.nombre_servicio),1),e("td",Me,"S/ "+s(Number(o.precio_serv||0).toFixed(2)),1),e("td",Ne,s(o.tiempo_estimado_serv),1),e("td",Ve,[e("button",{onClick:F=>ue(o),class:"text-blue-400 hover:text-blue-300 text-xs font-semibold"}," âœï¸ ",8,Ue),e("button",{onClick:F=>de(o.id_servicio),class:"text-red-400 hover:text-red-300 text-xs font-semibold"}," ðŸ—‘ ",8,Le)])],2))),128)),v.value.length?x("",!0):(n(),i("tr",$e,[e("td",{colspan:"5",class:r(["text-center py-3",a.value?"text-gray-300":"text-gray-500"])}," No hay servicios registrados con los filtros actuales ",2)]))])],2),v.value.length>E?(n(),i("div",Ae,[e("span",{class:r(a.value?"text-gray-300":"text-gray-600")},[t[15]||(t[15]=_(" Mostrando ",-1)),e("b",null,s(Y.value),1),t[16]||(t[16]=_(" - ",-1)),e("b",null,s(Z.value),1),t[17]||(t[17]=_(" de ",-1)),e("b",null,s(v.value.length),1),t[18]||(t[18]=_(" servicios ",-1))],2),e("div",je,[e("button",{type:"button",onClick:te,disabled:b.value===1,class:r(["px-3 py-1 rounded-lg border font-semibold disabled:opacity-50 disabled:cursor-not-allowed",a.value?"border-gray-600 text-gray-100 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," â—€ Anterior ",10,Be),e("span",{class:r(a.value?"text-gray-200":"text-gray-700")}," PÃ¡gina "+s(b.value)+" de "+s(U.value),3),e("button",{type:"button",onClick:ee,disabled:b.value===U.value||U.value===0,class:r(["px-3 py-1 rounded-lg border font-semibold disabled:opacity-50 disabled:cursor-not-allowed",a.value?"border-gray-600 text-gray-100 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," Siguiente â–¶ ",10,Ie)])])):x("",!0)])):x("",!0),M.value?(n(),i("div",ze,[e("div",Fe,[e("h3",{class:r(["text-xl font-bold",a.value?"text-blue-400":"text-blue-700"])}," Detalle de servicios por proyecto ",2),e("button",{onClick:pe,class:"btn-gray text-xs md:text-sm"},s(C.value?"Ocultar lista detalle":"Listar detalle"),1)]),e("form",{onSubmit:K(be,["prevent"]),class:"grid grid-cols-2 gap-4 mb-6"},[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-semibold mb-1"},"Proyecto",-1)),f(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>d.value.id_proyecto=o),class:r(["input",y.value])},[t[19]||(t[19]=e("option",{disabled:"",value:""},"Seleccione proyecto",-1)),(n(!0),i(j,null,B(R.value,o=>(n(),i("option",{key:o.id_proyecto,value:o.id_proyecto},s(o.nombre_pro),9,Te))),128))],2),[[J,d.value.id_proyecto]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-semibold mb-1"},"Servicio",-1)),f(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>d.value.id_servicio=o),class:r(["input",y.value])},[t[21]||(t[21]=e("option",{disabled:"",value:""},"Seleccione servicio",-1)),(n(!0),i(j,null,B(N.value,o=>(n(),i("option",{key:o.id_servicio,value:o.id_servicio},s(o.nombre_servicio),9,Oe))),128))],2),[[J,d.value.id_servicio]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-semibold mb-1"},"Precio unitario",-1)),f(e("input",{type:"number",step:"0.01","onUpdate:modelValue":t[7]||(t[7]=o=>d.value.precio_unitario=o),class:r(["input",y.value])},null,2),[[h,d.value.precio_unitario]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-semibold mb-1"},"Sub total",-1)),f(e("input",{type:"number",step:"0.01","onUpdate:modelValue":t[8]||(t[8]=o=>d.value.sub_total=o),class:r(["input",y.value])},null,2),[[h,d.value.sub_total]])]),e("div",Re,[e("button",qe,s(D.value?"Actualizar detalle":"Registrar detalle"),1),D.value?(n(),i("button",{key:0,type:"button",onClick:ye,class:"btn-gray text-xs md:text-sm"}," Cancelar ")):x("",!0)])],32),C.value?(n(),i("div",Ge,[e("table",{class:r(["w-full rounded-lg text-sm",a.value?"border border-gray-700":"border border-gray-200"])},[t[25]||(t[25]=e("thead",{class:"bg-indigo-600 text-white"},[e("tr",null,[e("th",{class:"px-2 py-2"},"Proyecto"),e("th",{class:"px-2 py-2"},"Servicio"),e("th",{class:"px-2 py-2"},"Precio unitario"),e("th",{class:"px-2 py-2"},"Sub total"),e("th",{class:"px-2 py-2"},"Acciones")])],-1)),e("tbody",null,[(n(!0),i(j,null,B(oe.value,o=>(n(),i("tr",{key:o.id_proyecto_servicio,class:r(["border-b",a.value?"border-gray-700 hover:bg-gray-800":"border-gray-200 hover:bg-gray-50"])},[e("td",He,s(o.proyecto?o.proyecto.nombre_pro:""),1),e("td",Ke,s(o.servicio?o.servicio.nombre_servicio:""),1),e("td",Je," S/ "+s(Number(o.precio_unitario||0).toFixed(2)),1),e("td",Qe," S/ "+s(Number(o.sub_total||0).toFixed(2)),1),e("td",We,[e("button",{onClick:F=>ge(o),class:"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs font-semibold"}," âœï¸ Editar ",8,Xe),e("button",{onClick:F=>me(o.id_proyecto_servicio),class:"bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs font-semibold"}," ðŸ—‘ Eliminar ",8,Ye)])],2))),128)),c.value.length?x("",!0):(n(),i("tr",Ze,[e("td",{colspan:"5",class:r(["text-center py-3",a.value?"text-gray-300":"text-gray-500"])}," No hay registros de detalle ",2)]))])],2),c.value.length>P?(n(),i("div",et,[e("span",{class:r(a.value?"text-gray-300":"text-gray-600")},[t[26]||(t[26]=_(" Mostrando ",-1)),e("b",null,s(le.value),1),t[27]||(t[27]=_(" - ",-1)),e("b",null,s(re.value),1),t[28]||(t[28]=_(" de ",-1)),e("b",null,s(c.value.length),1),t[29]||(t[29]=_(" registros ",-1))],2),e("div",tt,[e("button",{type:"button",onClick:ae,disabled:g.value===1,class:r(["px-3 py-1 rounded-lg border font-semibold disabled:opacity-50 disabled:cursor-not-allowed",a.value?"border-gray-600 text-gray-100 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," â—€ Anterior ",10,ot),e("span",{class:r(a.value?"text-gray-200":"text-gray-700")}," PÃ¡gina "+s(g.value)+" de "+s(L.value),3),e("button",{type:"button",onClick:se,disabled:g.value===L.value||L.value===0,class:r(["px-3 py-1 rounded-lg border font-semibold disabled:opacity-50 disabled:cursor-not-allowed",a.value?"border-gray-600 text-gray-100 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," Siguiente â–¶ ",10,lt)])])):x("",!0)])):x("",!0)])):x("",!0)],2))}},it=fe(rt,[["__scopeId","data-v-b0fe259c"]]);export{it as default};
