import{q as f,d as n,H as la,A as oa,L as T,e as v,a,f as k,n as r,l as m,v as C,t as s,K as M,F as N,i as $,h as w,k as ra,o as p}from"./app-DZXOPLfm.js";import{_ as sa}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ua={class:"flex gap-4 mb-6"},na=["disabled"],ia=["value"],da={key:0,class:"mt-2 flex items-center gap-2"},ba=["src"],va={key:0,class:"mt-2 flex items-center gap-2"},pa=["src"],ca={class:"col-span-2 flex justify-end gap-2"},ma={type:"submit",class:"btn-green text-xs md:text-sm"},fa={key:0,class:"overflow-x-auto"},ga={class:"px-2 py-2"},xa={class:"px-2 py-2"},ya={class:"px-2 py-2"},_a={class:"px-2 py-2"},ja={class:"px-2 py-2"},ka={class:"px-2 py-2 flex justify-center gap-3"},Ca=["onClick"],wa=["onClick"],ha={key:0},Ua={key:0,class:"flex flex-col md:flex-row justify-between items-center gap-3 mt-4 text-xs md:text-sm"},Ea={class:"flex items-center gap-2"},Ta=["disabled"],qa=["disabled"],h=5,Sa={__name:"Trabajadores",props:{darkMode:{type:Boolean,default:!1},fontClass:{type:String,default:"font-sans"}},setup(B){const D="https://www.tecnoweb.org.bo/inf513/grupo06cc/metaluv-camiri/public/".replace(/\/$/,""),L=l=>l?l.startsWith("http")?l:`${D.replace("/public","")}/storage/app/public/${l}`:null,R=B,i=f(()=>R.darkMode),Q=f(()=>R.fontClass||"font-sans"),d=f(()=>i.value?"bg-gray-900 border border-gray-700 text-gray-100 placeholder-gray-400":"bg-white border border-gray-300 text-gray-900 placeholder-gray-400"),u=n([]),F=n([]),y=n(!1),q=n(""),c=n(!1),S=n(null),o=n({id_usuario:"",nombre_trabajador:"",apellido_trabajador:"",cargo_trabajador:"",sueldo_trabajador:"",telefono_trabajador:"",tipo_contrato_trab:"",saldo_pendiente_trab:"",foto:null,codigoqr:null}),_=n(null),j=n(null),g=n(null),x=n(null),b=n(1),E=f(()=>u.value.length?Math.ceil(u.value.length/h):0),z=f(()=>{const l=(b.value-1)*h;return u.value.slice(l,l+h)}),O=f(()=>u.value.length?(b.value-1)*h+1:0),W=f(()=>u.value.length?Math.min(b.value*h,u.value.length):0);function G(){b.value<E.value&&b.value++}function H(){b.value>1&&b.value--}la(u,()=>{b.value=1});const K=f(()=>{const l=new Set(u.value.map(t=>t.id_usuario).filter(t=>t)),e=o.value.id_usuario;return F.value.filter(t=>t.id_usuario.startsWith("trab_m")?c.value&&t.id_usuario===e?!0:!l.has(t.id_usuario):!1)});oa(()=>{V(),U()});function V(){T.get("propietario/melamina/usuarios").then(l=>{F.value=l.data.usuarios||[]}).catch(l=>{console.error("Error al obtener usuarios:",l)})}function I(l,e){const t=l.target.files[0];t&&(e==="foto"?(o.value.foto=t,_.value=URL.createObjectURL(t)):(o.value.codigoqr=t,j.value=URL.createObjectURL(t)))}function J(){o.value.foto=null,_.value=null,g.value&&(g.value.value=null)}function X(){o.value.codigoqr=null,j.value=null,x.value&&(x.value.value=null)}function Y(){const l=new FormData;for(const t in o.value)o.value[t]!==null&&o.value[t]!==""&&l.append(t,o.value[t]);const e=c.value?`propietario/melamina/trabajadores/${S.value}`:"propietario/melamina/trabajadores";T.post(e,l,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{t.data.success&&(alert(c.value?"Trabajador actualizado":"Trabajador registrado"),P(),U(),V())}).catch(t=>{console.error("Error al guardar trabajador:",t),alert("Error al guardar trabajador")})}function Z(l){c.value=!0,S.value=l.id_trabajador,o.value.id_usuario=l.id_usuario,o.value.nombre_trabajador=l.nombre_trabajador,o.value.apellido_trabajador=l.apellido_trabajador,o.value.cargo_trabajador=l.cargo_trabajador,o.value.sueldo_trabajador=l.sueldo_trabajador,o.value.telefono_trabajador=l.telefono_trabajador,o.value.tipo_contrato_trab=l.tipo_contrato_trab,o.value.saldo_pendiente_trab=l.saldo_pendiente_trab,o.value.foto=null,o.value.codigoqr=null,_.value=L(l.foto_trabajador),j.value=L(l.codigoqr_trab),g.value&&(g.value.value=null),x.value&&(x.value.value=null)}function aa(){c.value=!1,P()}function ea(l){confirm("Â¿Eliminar este trabajador?")&&T.delete(`propietario/melamina/trabajadores/${l}`).then(()=>{U(),V()}).catch(e=>{console.error("Error al eliminar trabajador:",e),alert("Error al eliminar trabajador")})}function P(){c.value=!1,S.value=null,_.value=null,j.value=null,g.value&&(g.value.value=null),x.value&&(x.value.value=null),o.value={id_usuario:"",nombre_trabajador:"",apellido_trabajador:"",cargo_trabajador:"",sueldo_trabajador:"",telefono_trabajador:"",tipo_contrato_trab:"",saldo_pendiente_trab:"",foto:null,codigoqr:null}}function U(){T.get("propietario/melamina/trabajadores",{params:{buscar:q.value}}).then(l=>{u.value=l.data.trabajadores||[],y.value=!0}).catch(l=>{console.error("Error al obtener trabajadores:",l),alert("Error al obtener trabajadores")})}function ta(){y.value=!y.value,y.value&&U()}return(l,e)=>(p(),v("div",{class:r(["p-8 rounded-2xl shadow-md transition-colors duration-300",i.value?"bg-gray-800 text-gray-100":"bg-white text-gray-900",Q.value])},[a("h2",{class:r(["text-2xl font-bold mb-6",i.value?"text-blue-400":"text-blue-700"])}," GestiÃ³n de Trabajadores ",2),a("div",ua,[m(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>q.value=t),placeholder:"ðŸ” Buscar por nombre, apellido o ID...",class:r(["input flex-1",d.value])},null,2),[[C,q.value]]),a("button",{onClick:U,class:"btn-blue text-xs md:text-sm"}," Buscar "),a("button",{onClick:ta,class:"btn-gray text-xs md:text-sm"},s(y.value?"Ocultar Lista":"Listar"),1)]),a("form",{onSubmit:ra(Y,["prevent"]),class:"grid grid-cols-2 gap-4 mb-6"},[a("div",null,[e[13]||(e[13]=a("label",{class:"block text-sm font-semibold mb-1"},"Usuario",-1)),m(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.id_usuario=t),class:r(["input",d.value]),disabled:c.value},[e[11]||(e[11]=a("option",{disabled:"",value:""},"Seleccione usuario",-1)),(p(!0),v(N,null,$(K.value,t=>(p(),v("option",{key:t.id_usuario,value:t.id_usuario},s(t.id_usuario),9,ia))),128))],10,na),[[M,o.value.id_usuario]]),a("p",{class:r(["text-xs mt-1",i.value?"text-gray-300":"text-gray-500"])},[...e[12]||(e[12]=[w(" Primero crea el usuario en la secciÃ³n Usuarios (prefijo ",-1),a("b",null,"trab_m",-1),w("), luego selecciÃ³nalo aquÃ­. ",-1)])],2)]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-sm font-semibold mb-1"},"Nombre",-1)),m(a("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>o.value.nombre_trabajador=t),class:r(["input",d.value])},null,2),[[C,o.value.nombre_trabajador]])]),a("div",null,[e[15]||(e[15]=a("label",{class:"block text-sm font-semibold mb-1"},"Apellido",-1)),m(a("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>o.value.apellido_trabajador=t),class:r(["input",d.value])},null,2),[[C,o.value.apellido_trabajador]])]),a("div",null,[e[17]||(e[17]=a("label",{class:"block text-sm font-semibold mb-1"},"Cargo",-1)),m(a("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.cargo_trabajador=t),class:r(["input",d.value])},[...e[16]||(e[16]=[a("option",{disabled:"",value:""},"Selecciona",-1),a("option",null,"Ayudante",-1),a("option",null,"Maestro",-1)])],2),[[M,o.value.cargo_trabajador]])]),a("div",null,[e[18]||(e[18]=a("label",{class:"block text-sm font-semibold mb-1"},"Sueldo",-1)),m(a("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=t=>o.value.sueldo_trabajador=t),class:r(["input",d.value]),step:"0.01"},null,2),[[C,o.value.sueldo_trabajador]])]),a("div",null,[e[19]||(e[19]=a("label",{class:"block text-sm font-semibold mb-1"},"TelÃ©fono",-1)),m(a("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=t=>o.value.telefono_trabajador=t),class:r(["input",d.value])},null,2),[[C,o.value.telefono_trabajador]])]),a("div",null,[e[21]||(e[21]=a("label",{class:"block text-sm font-semibold mb-1"},"Tipo de Contrato",-1)),m(a("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.tipo_contrato_trab=t),class:r(["input",d.value])},[...e[20]||(e[20]=[a("option",{disabled:"",value:""},"Selecciona",-1),a("option",{value:"Eventual"},"Eventual",-1),a("option",{value:"Contrato"},"Contrato",-1)])],2),[[M,o.value.tipo_contrato_trab]])]),a("div",null,[e[22]||(e[22]=a("label",{class:"block text-sm font-semibold mb-1"},"Saldo Pendiente",-1)),m(a("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=t=>o.value.saldo_pendiente_trab=t),class:r(["input",d.value])},null,2),[[C,o.value.saldo_pendiente_trab]])]),a("div",null,[e[23]||(e[23]=a("label",{class:"block text-sm font-semibold mb-1"},"Foto",-1)),a("input",{type:"file",ref_key:"fotoInput",ref:g,onChange:e[9]||(e[9]=t=>I(t,"foto")),class:r(["input",d.value])},null,34),_.value?(p(),v("div",da,[a("img",{src:_.value,class:"w-24 h-24 rounded-full object-cover border"},null,8,ba),a("button",{type:"button",onClick:J,class:"text-red-400 text-sm font-semibold hover:text-red-300"}," âœ– Quitar ")])):k("",!0)]),a("div",null,[e[24]||(e[24]=a("label",{class:"block text-sm font-semibold mb-1"},"CÃ³digo QR",-1)),a("input",{type:"file",ref_key:"qrInput",ref:x,onChange:e[10]||(e[10]=t=>I(t,"codigoqr")),class:r(["input",d.value])},null,34),j.value?(p(),v("div",va,[a("img",{src:j.value,class:"w-24 h-24 rounded-lg object-cover border"},null,8,pa),a("button",{type:"button",onClick:X,class:"text-red-400 text-sm font-semibold hover:text-red-300"}," âœ– Quitar ")])):k("",!0)]),a("div",ca,[a("button",ma,s(c.value?"Actualizar":"Registrar"),1),c.value?(p(),v("button",{key:0,type:"button",onClick:aa,class:"btn-gray text-xs md:text-sm"}," Cancelar ")):k("",!0)])],32),y.value?(p(),v("div",fa,[a("table",{class:r(["w-full rounded-lg text-sm",i.value?"border border-gray-700":"border border-gray-200"])},[e[25]||(e[25]=a("thead",{class:"bg-blue-600 text-white"},[a("tr",null,[a("th",{class:"px-2 py-2"},"Nombre"),a("th",{class:"px-2 py-2"},"Apellido"),a("th",{class:"px-2 py-2"},"Cargo"),a("th",{class:"px-2 py-2"},"Contrato"),a("th",{class:"px-2 py-2"},"Sueldo"),a("th",{class:"px-2 py-2"},"Acciones")])],-1)),a("tbody",null,[(p(!0),v(N,null,$(z.value,t=>(p(),v("tr",{key:t.id_trabajador,class:r(["border-b",i.value?"border-gray-700 hover:bg-gray-800":"border-gray-200 hover:bg-gray-100"])},[a("td",ga,s(t.nombre_trabajador),1),a("td",xa,s(t.apellido_trabajador),1),a("td",ya,s(t.cargo_trabajador),1),a("td",_a,s(t.tipo_contrato_trab),1),a("td",ja," S/ "+s(Number(t.sueldo_trabajador||0).toFixed(2)),1),a("td",ka,[a("button",{onClick:A=>Z(t),class:"text-blue-400 hover:text-blue-300 text-xs font-semibold"}," âœï¸ Editar ",8,Ca),a("button",{onClick:A=>ea(t.id_trabajador),class:"text-red-400 hover:text-red-300 text-xs font-semibold"}," ðŸ—‘ Eliminar ",8,wa)])],2))),128)),u.value.length?k("",!0):(p(),v("tr",ha,[a("td",{colspan:"6",class:r(["text-center py-3",i.value?"text-gray-300":"text-gray-500"])}," No hay trabajadores registrados ",2)]))])],2),u.value.length>h?(p(),v("div",Ua,[a("span",{class:r(i.value?"text-gray-300":"text-gray-600")},[e[26]||(e[26]=w(" Mostrando ",-1)),a("b",null,s(O.value),1),e[27]||(e[27]=w(" - ",-1)),a("b",null,s(W.value),1),e[28]||(e[28]=w(" de ",-1)),a("b",null,s(u.value.length),1),e[29]||(e[29]=w(" trabajadores ",-1))],2),a("div",Ea,[a("button",{type:"button",onClick:H,disabled:b.value===1,class:r(["px-3 py-1 rounded-lg border font-semibold disabled:opacity-50 disabled:cursor-not-allowed",i.value?"border-gray-600 text-gray-100 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," â—€ Anterior ",10,Ta),a("span",{class:r(i.value?"text-gray-200":"text-gray-700")}," PÃ¡gina "+s(b.value)+" de "+s(E.value),3),a("button",{type:"button",onClick:G,disabled:b.value===E.value||E.value===0,class:r(["px-3 py-1 rounded-lg border font-semibold disabled:opacity-50 disabled:cursor-not-allowed",i.value?"border-gray-600 text-gray-100 hover:bg-gray-700":"border-gray-300 text-gray-800 hover:bg-gray-100"])}," Siguiente â–¶ ",10,qa)])])):k("",!0)])):k("",!0)],2))}},La=sa(Sa,[["__scopeId","data-v-c0893c47"]]);export{La as default};
