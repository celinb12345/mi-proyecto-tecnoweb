import{d as p,q as $,H as J,A as Q,e as c,a as t,f as V,l as f,v as k,n as u,K as X,F as U,i as B,h as _,t as b,k as Y,L as C,o as g}from"./app-DZXOPLfm.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"flex mb-4 gap-2"},te=["disabled"],le=["value"],ae={class:"col-span-2 mt-2 flex flex-wrap justify-end gap-2"},re={type:"submit",class:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow-sm"},oe={key:1,class:"mt-6 overflow-x-auto"},se={class:"min-w-full border border-gray-300 text-center text-sm"},ie={class:"border p-2"},ne={class:"border p-2"},ue={class:"border p-2"},de={class:"border p-2"},ce={class:"border p-2 space-x-2"},be=["onClick"],ge=["onClick"],ve={key:0,class:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mt-3 text-xs md:text-sm"},pe={class:"flex flex-wrap items-center gap-1"},ye=["disabled"],me=["onClick"],xe=["disabled"],h="rounded-lg p-2 w-full focus:ring-2 focus:ring-blue-400 focus:outline-none transition-colors duration-200",fe={__name:"Clientes",props:{darkMode:{type:Boolean,default:!1},fontClass:{type:String,default:"font-sans"}},setup(P){const i=P,r=p({id_cliente:"",id_usuario:"",nombre_cli:"",apellido_cli:"",telefono_cli:"",correo_cli:""}),d=p([]),L=p([]),M=p(""),o=p(""),s=p("text-green-600"),v=p(!1),y=p(!1),T=$(()=>{const a=new Set(d.value.map(l=>l.id_usuario).filter(l=>l)),e=r.value.id_usuario;return L.value.filter(l=>l.id_usuario.startsWith("cli_c")?y.value&&l.id_usuario===e?!0:!a.has(l.id_usuario):!1)}),n=p(1),w=p(5),m=$(()=>d.value.length?Math.ceil(d.value.length/w.value):1),j=$(()=>{const a=(n.value-1)*w.value;return d.value.slice(a,a+w.value)}),N=$(()=>{if(!d.value.length)return{from:0,to:0};const a=(n.value-1)*w.value+1,e=Math.min(n.value*w.value,d.value.length);return{from:a,to:e}});J(d,()=>{n.value>m.value&&(n.value=m.value)});function A(a){a>=1&&a<=m.value&&(n.value=a)}function D(){n.value>1&&n.value--}function I(){n.value<m.value&&n.value++}async function x(a={}){try{const e=await C.get("propietario/Construccion/clientes",{params:a});d.value=e.data.clientes||[],n.value=1,o.value="Lista de clientes actualizada",s.value="text-green-600"}catch(e){console.error(e),o.value="Error al conectar con el servidor",s.value="text-red-600"}}async function F(){v.value?v.value=!1:(await x(),v.value=!0)}async function q(){return y.value&&r.value.id_cliente?G():R()}async function R(){try{const a=await C.post("propietario/Construccion/clientes",r.value);a.data.success?(o.value=a.data.message,s.value="text-green-600",E(),v.value&&await x()):(o.value=a.data.message||"Error al registrar cliente",s.value="text-red-600")}catch(a){console.error(a),o.value="Error al conectar con el servidor",s.value="text-red-600"}}async function G(){try{const a=r.value.id_cliente,e={nombre_cli:r.value.nombre_cli,apellido_cli:r.value.apellido_cli,telefono_cli:r.value.telefono_cli,correo_cli:r.value.correo_cli},l=await C.put(`propietario/Construccion/clientes/${a}`,e);l.data.success?(o.value=l.data.message,s.value="text-green-600",y.value=!1,E(),v.value&&await x()):(o.value=l.data.message||"Error al actualizar cliente",s.value="text-red-600")}catch(a){console.error(a),o.value="Error al conectar con el servidor",s.value="text-red-600"}}function H(a){r.value={...a},y.value=!0,o.value=`Editando cliente: ${a.nombre_cli} ${a.apellido_cli}`,s.value="text-blue-600"}function z(){y.value=!1,E(),o.value="EdiciÃ³n cancelada",s.value="text-gray-500"}async function K(){if(!M.value.trim()){o.value="Ingrese texto para buscar",s.value="text-red-600";return}await x({buscar:M.value}),v.value=!0,d.value.length?(o.value=`${d.value.length} resultado(s) encontrado(s)`,s.value="text-green-600"):(o.value="No se encontraron coincidencias",s.value="text-red-600")}function E(){r.value={id_cliente:"",id_usuario:"",nombre_cli:"",apellido_cli:"",telefono_cli:"",correo_cli:""}}async function O(a){if(confirm(`Â¿Eliminar al cliente "${a.nombre_cli} ${a.apellido_cli}"?`))try{const e=await C.delete(`propietario/Construccion/clientes/${a.id_cliente}`);e.data.success&&(o.value=e.data.message,s.value="text-green-600",v.value&&await x(),y.value&&r.value.id_cliente===a.id_cliente&&z())}catch(e){console.error(e),o.value="Error al eliminar cliente",s.value="text-red-600"}}async function W(){try{const a=await C.get("propietario/Construccion/usuarios");L.value=a.data.usuarios||[]}catch(a){console.error("Error al cargar usuarios:",a)}}return Q(async()=>{await Promise.all([x(),W()])}),(a,e)=>(g(),c("div",{class:u(["p-8 rounded-2xl shadow-md transition-colors duration-300",i.darkMode?"bg-gray-800 text-gray-100":"bg-white text-gray-900",i.fontClass])},[e[19]||(e[19]=t("h2",{class:"text-2xl font-bold text-blue-500 mb-4"},"GestiÃ³n de Clientes",-1)),t("div",ee,[f(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>M.value=l),placeholder:"ðŸ” Buscar por nombre, apellido o ID usuario...",class:u(["flex-grow",h,i.darkMode?"bg-gray-900 border-gray-600 text-gray-100 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"])},null,2),[[k,M.value]]),t("button",{onClick:K,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-sm"}," Buscar ")]),t("form",{onSubmit:Y(q,["prevent"]),class:"grid grid-cols-2 gap-4"},[t("div",null,[e[7]||(e[7]=t("label",{class:"text-sm font-semibold mb-1 block"},"ID Usuario (cliente)",-1)),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.id_usuario=l),class:u([h,i.darkMode?"bg-gray-900 border-gray-600 text-gray-100":"bg-white border-gray-300 text-gray-900"]),disabled:y.value},[e[6]||(e[6]=t("option",{disabled:"",value:""},"Seleccione usuario",-1)),(g(!0),c(U,null,B(T.value,l=>(g(),c("option",{key:l.id_usuario,value:l.id_usuario},b(l.id_usuario),9,le))),128))],10,te),[[X,r.value.id_usuario]]),e[8]||(e[8]=t("p",{class:"text-xs text-gray-400 mt-1"},[_(" Se muestran solo usuarios del tipo "),t("b",null,"cli_m"),_(" que aÃºn no estÃ¡n asignados a un cliente. ")],-1))]),t("div",null,[e[9]||(e[9]=t("label",{class:"text-sm font-semibold mb-1 block"},"Nombre",-1)),f(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=l=>r.value.nombre_cli=l),class:u([h,i.darkMode?"bg-gray-900 border-gray-600 text-gray-100 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"])},null,2),[[k,r.value.nombre_cli]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"text-sm font-semibold mb-1 block"},"Apellido",-1)),f(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>r.value.apellido_cli=l),class:u([h,i.darkMode?"bg-gray-900 border-gray-600 text-gray-100 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"])},null,2),[[k,r.value.apellido_cli]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"text-sm font-semibold mb-1 block"},"TelÃ©fono",-1)),f(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=l=>r.value.telefono_cli=l),placeholder:"+591 ...",class:u([h,i.darkMode?"bg-gray-900 border-gray-600 text-gray-100 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"])},null,2),[[k,r.value.telefono_cli]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"text-sm font-semibold mb-1 block"},"Correo",-1)),f(t("input",{type:"email","onUpdate:modelValue":e[5]||(e[5]=l=>r.value.correo_cli=l),placeholder:"correo@ejemplo.com",class:u([h,i.darkMode?"bg-gray-900 border-gray-600 text-gray-100 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"])},null,2),[[k,r.value.correo_cli]])]),t("div",ae,[t("button",re,b(y.value?"Actualizar":"Registrar"),1),t("button",{type:"button",onClick:F,class:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg shadow-sm"},b(v.value?"Ocultar lista":"Listar"),1),t("button",{type:"button",onClick:E,class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg shadow-sm"}," Limpiar "),y.value?(g(),c("button",{key:0,type:"button",onClick:z,class:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg shadow-sm"}," Cancelar ediciÃ³n ")):V("",!0)])],32),o.value?(g(),c("p",{key:0,class:u(["mt-4 font-semibold text-sm",s.value])},b(o.value),3)):V("",!0),v.value&&d.value.length?(g(),c("div",oe,[e[18]||(e[18]=t("h3",{class:"font-bold mb-2"},"Clientes Registrados",-1)),t("table",se,[t("thead",{class:u(i.darkMode?"bg-blue-800 text-white":"bg-blue-600 text-white")},[...e[13]||(e[13]=[t("tr",null,[t("th",{class:"border border-blue-500/50 p-2"},"Nombre"),t("th",{class:"border border-blue-500/50 p-2"},"Apellido"),t("th",{class:"border border-blue-500/50 p-2"},"TelÃ©fono"),t("th",{class:"border border-blue-500/50 p-2"},"Correo"),t("th",{class:"border border-blue-500/50 p-2"},"Acciones")],-1)])],2),t("tbody",null,[(g(!0),c(U,null,B(j.value,l=>(g(),c("tr",{key:l.id_cliente,class:u(i.darkMode?"hover:bg-gray-700":"hover:bg-gray-50")},[t("td",ie,b(l.nombre_cli),1),t("td",ne,b(l.apellido_cli),1),t("td",ue,b(l.telefono_cli||"-"),1),t("td",de,b(l.correo_cli),1),t("td",ce,[t("button",{onClick:S=>H(l),class:"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-xs"}," Editar ",8,be),t("button",{onClick:S=>O(l),class:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs"}," Eliminar ",8,ge)])],2))),128))])]),m.value>1?(g(),c("div",ve,[t("div",null,[e[14]||(e[14]=_(" Mostrando ",-1)),t("b",null,b(N.value.from),1),e[15]||(e[15]=_(" - ",-1)),t("b",null,b(N.value.to),1),e[16]||(e[16]=_(" de ",-1)),t("b",null,b(d.value.length),1),e[17]||(e[17]=_(" clientes ",-1))]),t("div",pe,[t("button",{class:u(["px-2 py-1 rounded border",i.darkMode?"bg-gray-800 border-gray-600":"bg-white border-gray-300"]),onClick:D,disabled:n.value===1}," â¬… ",10,ye),(g(!0),c(U,null,B(m.value,l=>(g(),c("button",{key:l,class:u(["px-2 py-1 rounded border text-xs",[l===n.value?"bg-blue-600 text-white border-blue-500":i.darkMode?"bg-gray-800 text-gray-100 border-gray-600 hover:bg-gray-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"]]),onClick:S=>A(l)},b(l),11,me))),128)),t("button",{class:u(["px-2 py-1 rounded border",i.darkMode?"bg-gray-800 border-gray-600":"bg-white border-gray-300"]),onClick:I,disabled:n.value===m.value}," âž¡ ",10,xe)])])):V("",!0)])):v.value&&!d.value.length?(g(),c("div",{key:2,class:u(["mt-6 text-sm",i.darkMode?"text-gray-300":"text-gray-600"])}," No hay clientes registrados. ",2)):V("",!0)],2))}},we=Z(fe,[["__scopeId","data-v-f7308bda"]]);export{we as default};
