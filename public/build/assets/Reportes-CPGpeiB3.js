import{y as N,q as m,d as f,e as g,a as e,l as x,n as o,v as C,K as P,k as z,h as b,t as d,f as M,F as A,i as q,L as O,o as c}from"./app-DZXOPLfm.js";import{h as H,E as W}from"./jspdf.es.min-DPk-E62e.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4"},K={class:"flex gap-2"},$={class:"grid grid-cols-2 gap-2"},J={class:"md:col-span-4 flex justify-end"},X={class:"flex justify-end mb-4"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-xs md:text-sm"},Z={class:"mt-4 overflow-x-auto"},ee={key:0},te={key:1},oe={key:0},ae={key:0},le={__name:"Reportes",props:{darkMode:{type:Boolean,default:!1},fontClass:{type:String,default:"font-sans"},pagos:{type:Array,default:()=>[]},resumen:{type:Object,default:()=>({})},filtrosIniciales:{type:Object,default:()=>({sujeto:"todos",metodo:"",forma:"",desde:null,hasta:null})}},setup(B){const u=B,T=N(),E=T?.url?.startsWith("propietario/melamina/reportes/pagos")?T.url:"propietario/melamina/reportes/pagos",s=m(()=>u.darkMode),I=m(()=>u.fontClass||"font-sans"),v=m(()=>s.value?"bg-gray-900 border-gray-700 text-gray-100 placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"),r=m(()=>s.value?"border border-gray-700":"border border-gray-300"),k=f(u.pagos||[]),i=f({total_general:0,total_proveedores:0,total_trabajadores:0,total_efectivo:0,total_qr:0,total_directo:0,total_en_cuotas:0,...u.resumen}),n=f({sujeto:u.filtrosIniciales.sujeto??"todos",metodo:u.filtrosIniciales.metodo??"",forma:u.filtrosIniciales.forma??"",desde:u.filtrosIniciales.desde??null,hasta:u.filtrosIniciales.hasta??null}),_=f(""),D=f(!1),y=f(null),p=l=>Number(l||0).toLocaleString("es-BO",{style:"currency",currency:"BOB"});async function L(){try{D.value=!0;const{data:l}=await O.get(E,{params:{sujeto:n.value.sujeto,metodo:n.value.metodo||void 0,forma:n.value.forma||void 0,desde:n.value.desde||void 0,hasta:n.value.hasta||void 0}});k.value=l.pagos||[],i.value={...i.value,...l.resumen||{}}}catch(l){console.error(l),alert("Error al cargar el reporte de pagos.")}finally{D.value=!1}}const h=m(()=>{const l=_.value.toLowerCase().trim();return l?k.value.filter(t=>{const a=(t.concepto_pago||"").toLowerCase(),w=(t.metodo_pago||"").toLowerCase(),j=(t.tipo_pago||"").toLowerCase(),R=String(t.numero_comprobante||"");return a.includes(l)||w.includes(l)||j.includes(l)||R.includes(l)}):k.value}),S=m(()=>h.value.reduce((l,t)=>t.estado_pago?l+Number(t.monto_total_pago||0):l,0));function F(){n.value={sujeto:"todos",metodo:"",forma:"",desde:null,hasta:null},L()}function U(){if(!y.value)return;const l=y.value.innerHTML,t=window.open("","_blank","width=900,height=650");t.document.write(`
    <!doctype html>
    <html>
      <head>
        <title>Reporte de pagos</title>
        <style>
          body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont,
              'Segoe UI', sans-serif;
            padding: 16px;
          }
          table {
            border-collapse: collapse;
            width: 100%;
            font-size: 12px;
          }
          th, td {
            border: 1px solid #ccc;
            padding: 4px 6px;
          }
          th {
            background: #2563eb;
            color: #fff;
          }
          tfoot td {
            font-weight: bold;
          }
        </style>
      </head>
      <body>
        ${l}
      </body>
    </html>
  `),t.document.close(),t.focus(),t.print(),t.close()}async function V(){if(y.value)try{const l=await H(y.value,{scale:2}),t=l.toDataURL("image/png"),a=new W("p","mm","a4"),w=a.internal.pageSize.getWidth(),j=l.height*w/l.width;a.addImage(t,"PNG",0,0,w,j),a.save("reporte-pagos.pdf")}catch(l){console.error(l),alert("Error al generar el PDF del reporte.")}}return(l,t)=>(c(),g("div",{class:o(["p-8 rounded-2xl shadow-md transition-colors duration-300",s.value?"bg-gray-900 text-gray-100":"bg-white text-gray-900",I.value])},[e("div",G,[e("h2",{class:o(["text-2xl font-bold",s.value?"text-blue-400":"text-blue-700"])}," Reporte de pagos ",2),e("div",K,[e("button",{type:"button",class:o(["px-4 py-2 rounded-lg text-sm font-semibold border",s.value?"border-gray-600 text-gray-100 hover:bg-gray-800":"border-gray-300 text-gray-800 hover:bg-gray-100"]),onClick:F}," Limpiar filtros ",2)])]),x(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),placeholder:"ðŸ” Buscar en los pagos (concepto, tipo, mÃ©todo, comprobante)...",class:o(["input mb-4",v.value])},null,2),[[C,_.value]]),e("form",{class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",onSubmit:z(L,["prevent"])},[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-xs font-semibold mb-1"},"Sujeto",-1)),x(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>n.value.sujeto=a),class:o(["input text-sm",v.value])},[...t[6]||(t[6]=[e("option",{value:"todos"},"Todos",-1),e("option",{value:"proveedor"},"Proveedores",-1),e("option",{value:"trabajador"},"Trabajadores",-1)])],2),[[P,n.value.sujeto]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-xs font-semibold mb-1"},"MÃ©todo",-1)),x(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>n.value.metodo=a),class:o(["input text-sm",v.value])},[...t[8]||(t[8]=[e("option",{value:""},"Todos",-1),e("option",{value:"efectivo"},"Efectivo",-1),e("option",{value:"qr"},"QR",-1)])],2),[[P,n.value.metodo]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-xs font-semibold mb-1"},"Forma",-1)),x(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>n.value.forma=a),class:o(["input text-sm",v.value])},[...t[10]||(t[10]=[e("option",{value:""},"Todas",-1),e("option",{value:"directo"},"Directo",-1),e("option",{value:"cuotas"},"En cuotas",-1)])],2),[[P,n.value.forma]])]),e("div",$,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-xs font-semibold mb-1"},"Desde",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=a=>n.value.desde=a),class:o(["input text-sm",v.value])},null,2),[[C,n.value.desde]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-xs font-semibold mb-1"},"Hasta",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=a=>n.value.hasta=a),class:o(["input text-sm",v.value])},null,2),[[C,n.value.hasta]])])]),e("div",J,[e("button",{type:"submit",class:o(["px-4 py-2 rounded-lg text-sm font-semibold text-white",s.value?"bg-green-600 hover:bg-green-500":"bg-green-600 hover:bg-green-700"])}," ðŸ”„ Aplicar filtros ",2)])],32),e("div",X,[e("div",{class:o(["px-4 py-3 rounded-xl flex flex-wrap items-center gap-3 text-xs md:text-sm",s.value?"bg-gray-800":"bg-gray-100"])},[e("span",{class:o(s.value?"text-gray-200":"text-gray-700")}," Acciones del reporte: ",2),e("button",{type:"button",class:o(["px-3 py-1 rounded-lg font-semibold text-white text-xs md:text-sm",s.value?"bg-blue-600 hover:bg-blue-500":"bg-blue-600 hover:bg-blue-700"]),onClick:U}," ðŸ–¨ Imprimir ",2),e("button",{type:"button",class:o(["px-3 py-1 rounded-lg font-semibold text-white text-xs md:text-sm",s.value?"bg-indigo-600 hover:bg-indigo-500":"bg-indigo-600 hover:bg-indigo-700"]),onClick:V}," ðŸ“„ Descargar PDF ",2)],2)]),e("div",{ref_key:"printArea",ref:y,id:"reporte-pagos-area",class:"space-y-4"},[e("div",Y,[e("div",{class:o(["p-3 rounded-xl",s.value?"bg-gray-800":"bg-gray-100"])},[t[17]||(t[17]=e("h4",{class:"font-semibold mb-1"},"Totales generales",-1)),e("p",null,[t[14]||(t[14]=b("Total general: ",-1)),e("b",null,d(p(i.value.total_general)),1)]),e("p",null,[t[15]||(t[15]=b("Proveedores: ",-1)),e("b",null,d(p(i.value.total_proveedores)),1)]),e("p",null,[t[16]||(t[16]=b("Trabajadores: ",-1)),e("b",null,d(p(i.value.total_trabajadores)),1)])],2),e("div",{class:o(["p-3 rounded-xl",s.value?"bg-gray-800":"bg-gray-100"])},[t[20]||(t[20]=e("h4",{class:"font-semibold mb-1"},"Por mÃ©todo",-1)),e("p",null,[t[18]||(t[18]=b("Efectivo: ",-1)),e("b",null,d(p(i.value.total_efectivo)),1)]),e("p",null,[t[19]||(t[19]=b("QR: ",-1)),e("b",null,d(p(i.value.total_qr)),1)])],2),e("div",{class:o(["p-3 rounded-xl",s.value?"bg-gray-800":"bg-gray-100"])},[t[23]||(t[23]=e("h4",{class:"font-semibold mb-1"},"Por forma",-1)),e("p",null,[t[21]||(t[21]=b("Directo: ",-1)),e("b",null,d(p(i.value.total_directo)),1)]),e("p",null,[t[22]||(t[22]=b("En cuotas: ",-1)),e("b",null,d(p(i.value.total_en_cuotas)),1)])],2)]),e("div",Z,[e("table",{class:o(["w-full text-xs md:text-sm rounded-lg overflow-hidden",s.value?"border border-gray-700":"border border-gray-300"])},[e("thead",{class:o(s.value?"bg-blue-700 text-white":"bg-blue-600 text-white")},[e("tr",null,[e("th",{class:o(["border p-2",r.value])},"Fecha",2),e("th",{class:o(["border p-2",r.value])},"Tipo",2),e("th",{class:o(["border p-2",r.value])},"MÃ©todo",2),e("th",{class:o(["border p-2",r.value])},"Forma",2),e("th",{class:o(["border p-2",r.value])},"Concepto",2),e("th",{class:o(["border p-2",r.value])},"Comprobante",2),e("th",{class:o(["border p-2 text-right",r.value])},"Monto",2),e("th",{class:o(["border p-2 text-center",r.value])},"Estado",2)])],2),e("tbody",null,[(c(!0),g(A,null,q(h.value,a=>(c(),g("tr",{key:a.id_pago,class:o(s.value?"hover:bg-gray-800":"hover:bg-gray-50")},[e("td",{class:o(["border p-2",r.value])},d(a.fecha_pago),3),e("td",{class:o(["border p-2 capitalize",r.value])},d(a.tipo_pago),3),e("td",{class:o(["border p-2 capitalize",r.value])},d((a.metodo_pago||"").toLowerCase()||"â€”"),3),e("td",{class:o(["border p-2",r.value])},[(a.cuotas_pago||0)>0?(c(),g("span",ee," En cuotas ("+d(a.cuotas_pago)+") ",1)):(c(),g("span",te,"Directo"))],2),e("td",{class:o(["border p-2",r.value])},d(a.concepto_pago||"â€”"),3),e("td",{class:o(["border p-2 text-center",r.value])},d(a.numero_comprobante||"â€”"),3),e("td",{class:o(["border p-2 text-right",r.value])},d(p(a.monto_total_pago)),3),e("td",{class:o(["border p-2 text-center",r.value])},[e("span",{class:o(["px-2 py-1 rounded-full text-[11px] font-semibold",a.estado_pago?s.value?"bg-green-900 text-green-300":"bg-green-100 text-green-700":s.value?"bg-yellow-900 text-yellow-300":"bg-yellow-100 text-yellow-700"])},d(a.estado_pago?"Pagado":"Pendiente"),3)],2)],2))),128)),h.value.length?M("",!0):(c(),g("tr",oe,[e("td",{colspan:"8",class:o(["text-center py-3",s.value?"text-gray-300":"text-gray-500"])}," No hay pagos con los filtros actuales ",2)]))]),h.value.length?(c(),g("tfoot",ae,[e("tr",{class:o(s.value?"bg-gray-800 text-gray-100":"bg-gray-100 text-gray-800")},[e("td",{class:o(["border p-2 text-right font-semibold",r.value]),colspan:"6"}," Total pagado: ",2),e("td",{class:o(["border p-2 text-right font-bold",r.value])},d(p(S.value)),3),e("td",{class:o(["border p-2",r.value])},null,2)],2)])):M("",!0)],2)])],512)],2))}},de=Q(le,[["__scopeId","data-v-a2b7851c"]]);export{de as default};
